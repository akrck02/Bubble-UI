<!DOCTYPE html>
<html lang="en" data-theme="dark" data-bubble="material">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material You - Bubble UI</title>
    <link rel="stylesheet" href="../src/css/master.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>
<style>
    body {
        padding: 1rem;
        background: var(--background-color);
        transition: background-color var(--animation-fast);

        margin-bottom: 5rem;
        height: fit-content;
        padding-bottom: 6rem;
    }

    * {
        transition: background-color var(--animation-fast);
    }

    .surface,
    .primary-container,
    .secondary-container,
    .tertiary-container,
    .error-container {
        padding: 1rem;
    }

    .surface {
        margin-bottom: 1rem;
    }

    textarea {
        width: 100%;
    }

    .primary-container{
        margin-bottom: 2rem;
        margin-top: 1rem;
    }

    .secondary-container {
        margin-top: 2rem;
    }

    img.user-profile-pic {
        --size:2rem;
        width: var(--size);
        height: var(--size);
        border-radius: 5rem;
        margin-right: 1rem;
    }
    
    div.card {
        padding: 1.2rem 1.2rem;
        margin-bottom: 0rem;
    }
    
    div.card div.msg-info p.username {
        font-size: .75rem;
        margin-bottom: .35rem;
    }

    div.card div.msg-info p.date {
        font-size: .65rem;
        opacity: .5;
    }


    div.card svg {
        fill: var(--on-background) !important;
    }

    div.card p.message-to{
        font-size: .65rem;
        opacity: .5;
        margin: 1rem 0;
    }

    div.card div.content {
        line-height: 1.5rem;
        font-size: .85rem;
        margin-bottom: 1rem;
    }

    div.card div.button-bar button {
        padding: .5rem 3rem;
        font-size: .85rem;
    }

    :root[data-bubble="material"] div.nav-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        background: var(--secondary-container-color);
        width:100%;
        border-radius: 1.2rem 1.2rem 0rem 0rem;
        padding: 1rem 1rem;
        height: 5rem;
        margin-bottom: 0;
        box-shadow: 0rem -.2rem .3rem rgba(0,0,0, .1);
    }

    div.nav-bar div.button-group button {
        padding: .5rem 1.5rem;
        height: auto;
        background: var(--tertiary-container-color);
    }

    div.nav-bar div.button-group button span {
        font-size: 1.1rem;
    }

    div.nav-bar div.button-group label {
        font-size: .65rem;
        text-align: center;
    }

    div.nav-bar div.separator {
        width: 3.2rem;
    }

    :root[data-bubble=material] button.new-mail {
        position: fixed;
        bottom: 2.75rem;
        right: calc(50% - 2.5rem);

        width: 4rem;
        height: 4rem;
        box-shadow: 0rem -.2rem .3rem rgba(0,0,0, .1);
        z-index:2;
    }

    :root[data-bubble=material] button.new-mail span{
        color: var(--on-primary-color);
    }

</style>
<script>

    class Colors {

        static hexToRgb(hex) {
            const hexValue = hex.substring(1)
            const red = hexValue.substring(0, 2)
            const green = hexValue.substring(2, 4)
            const blue = hexValue.substring(4, 6)
            return [parseInt(red,16), parseInt(green,16), parseInt(blue,16)]
        }

        static rgbToHex(rgb) {
            const red = rgb[0].toString(16).padStart(2, '0')
            const green = rgb[1].toString(16).padStart(2, '0')
            const blue = rgb[2].toString(16).padStart(2, '0')
            return `#${red}${green}${blue}`
        }

        static getNewColor(color, difference, isDark) {

            const newColor = [color[0],color[1],color[2]];
            if (isDark){
                newColor[0] += difference
                newColor[1] += difference
                newColor[2] += difference
            } else {
                newColor[0] -= difference
                newColor[1] -= difference
                newColor[2] -= difference
            }

            return [
                Colors.getNumberIn0to255Range(newColor[0]),
                Colors.getNumberIn0to255Range(newColor[1]),
                Colors.getNumberIn0to255Range(newColor[2]),
            ]
        }

        static getNumberIn0to255Range(color) {

            if(color <= 0){
                return 0;
            }

            if (color >= 255){
                return 255;
            }

            return color;
        }

        static isDark(color) {
            return color[0] + color[1] + color[2] < 127 * 3 
        }

        static normalize(color) {

            const isDark = Colors.isDark(color);

            const r = color[0];
            const g = color[1];
            const b = color[2];

            if(isDark) {

                const rd = r / 17
                const gd = g / 17
                const bd = b / 17

                const min = Math.floor(Math.min(rd,gd,bd))
                for (let i = 0; i < min; i++) {
                    color = [
                        color[0] - 17,
                        color[1] - 17,
                        color[2] - 17,
                    ]
                    
                }
                console.log(rd, gd, bd);

                return color;
            } 

            const rd = (255 - r) / 17
            const gd = (255 - g) / 17
            const bd = (255 - b) / 17


            const min = Math.floor(Math.min(rd,gd,bd))
            for (let i = 0; i < min; i++) {
                color = [
                    color[0] + 17,
                    color[1] + 17,
                    color[2] + 17,
                ]
                
            }

            console.log(rd,gd,bd);

            return color;
        }
    }

    class ColorExtractor {

        static extractAll(color, isDark, baseChannel, extractedColors = [color]){

            if(baseChannel === undefined) {
                baseChannel = ColorExtractor.getBaseChannel(color, isDark);
            }

            const difference = 17;

            switch (baseChannel) {
                case "R":

                    if((isDark && color[0] >= 255) || (!isDark && color[0] <= 0)) {
                        return extractedColors;
                    }
                    break;
            
                case "G":

                    if((isDark && color[1] >= 255) || (!isDark && color[1] <= 0)) {
                        return extractedColors;
                    }
                    break;
                
                case "B":

                    if((isDark && color[2] >= 255) || (!isDark && color[2] <= 0)) {
                        return extractedColors;
                    }
                    break;

                default: throw new Error("INVALID BASE CHANNEL ON EXTRACT");
            }

            color = Colors.getNewColor(color, difference, isDark);
            extractedColors.push([color[0],color[1],color[2]]);
            extractedColors = ColorExtractor.extractAll(color, isDark, baseChannel, extractedColors);
            return extractedColors;
        }


        static getBaseChannel(color, isDark){
            if (isDark) {
                const min = Math.min(color[0],color[1],color[2]);
                switch (min) {
                    case color[0]: return "R";
                    case color[1]: return "G";
                    case color[2]: return "B";
                    default: throw new Error("IMPOSSIBLE COLOR ON GET BASE CHANNEL");
                }
            }

            const max = Math.max(color[0],color[1],color[2]);
            switch (max) {
                case color[0]: return "R";
                case color[1]: return "G";
                case color[2]: return "B";
                default: throw new Error("IMPOSSIBLE COLOR ON GET BASE CHANNEL");
            }
        }
    } 

    function applyColorsToBubble(colors, isDarkColor) {

        const textColor = Colors.rgbToHex(isDarkColor? [255,255,255]:[0,0,0]);

        document.body.style.setProperty("--background-color", Colors.rgbToHex(colors[colors.length-1]));
        document.body.style.setProperty("--on-background-color", textColor);

        //document.body.style.setProperty("--primary-color", Colors.rgbToHex(colors[colors.length-1]));
        document.body.style.setProperty("--primary-container-color", Colors.rgbToHex(colors[colors.length-2]));
        document.body.style.setProperty("--secondary-container-color", Colors.rgbToHex(colors[colors.length-3]));
        document.body.style.setProperty("--tertiary-container-color", Colors.rgbToHex(colors[colors.length-4]));
        document.body.style.setProperty("--item-background-color", Colors.rgbToHex(colors[colors.length-3]));
    }

    window.onload  = () =>{
        //setTimeout(() => window.location.reload(1), 5000);

        const colorInput = document.getElementById("color-picker");
        colorInput.oninput = (e) => {
            const baseColor = Colors.normalize(Colors.hexToRgb(colorInput.value));
            const isDarkColor = Colors.isDark(baseColor);

            console.log("BASE COLOR:",baseColor);
            console.log("DARK COLOR:",isDarkColor);

            let colors = ColorExtractor.extractAll(baseColor,isDarkColor);
            
            // reverse the colors array
            console.log(colors);
            colors.reverse();

            applyColorsToBubble(colors,isDarkColor);
        }

    }

</script>
<body class="box-column">

    <input id="color-picker" type="color"/>

    <div class="card primary-container box-column">
        <div class="box-row box-y-center box-x-between">
            <div class="user box-row box-y-center">
                <img class="user-profile-pic" src="./resources/photo.jpg" alt="akrck02" >
                <div class="msg-info box-column">
                    <p class="username">Akrck02 lol</p>
                    <p class="date">4 min ago</p>
                </div>
            </div>
            <span class="material-symbols-outlined">more_vert</span>
        </div>
        <p class="message-to">To Juan Diaz</p>
        <div class="content">
            LaoQuian! It's been to long! How are you? <br><br>
            I've been thinking about home and wiw so much lately. <br><br>
            Are you free next weekend? Diaz and odasuda want to catch up with you!
        </div>
        <div class="button-bar">
            <div class="box-row box-x-center">
                <button>Discard</button>
                <button class="primary">Reply</button>
            </div>
        </div>
    </div>
    <div class="card primary-container box-column">
        <div class="box-row box-y-center   box-x-between">
            <div class="user box-row box-y-center">
                <img class="user-profile-pic" src="./resources/photo.jpg" alt="akrck02" >
                <div class="msg-info box-column">
                    <p class="username">Akrck02</p>
                    <p class="date">4 min ago</p>
                </div>
            </div>
            <span class="material-symbols-outlined">more_vert</span>
        </div>
        <p class="message-to">To Juan Diaz</p>
        <div class="content">
            LaoQuian! It's been to long! How are you? <br><br>
            I've been thinking about home and wiw so much lately. <br><br>
            Are you free next weekend? Diaz and odasuda want to catch up with you!
        </div>
        <div class="button-bar">
            <div class="box-row box-x-center">
                <button>Discard</button>
                <button class="primary">Reply</button>
            </div>
        </div>
    </div>
    <div class="card primary-container box-column">
        <div class="box-row box-y-center   box-x-between">
            <div class="user box-row box-y-center">
                <img class="user-profile-pic" src="./resources/photo.jpg" alt="akrck02" >
                <div class="msg-info box-column">
                    <p class="username">Akrck02</p>
                    <p class="date">4 min ago</p>
                </div>
            </div>
            <span class="material-symbols-outlined">more_vert</span>
        </div>
        <p class="message-to">To Juan Diaz</p>
        <div class="content">
            LaoQuian! It's been to long! How are you? <br><br>
            I've been thinking about home and wiw so much lately. <br><br>
            Are you free next weekend? Diaz and odasuda want to catch up with you!
        </div>
        <div class="button-bar">
            <div class="box-row box-x-center">
                <button>Discard</button>
                <button class="primary">Reply</button>
            </div>
        </div>
    </div>
    <div class="card primary-container box-column">
        <div class="box-row box-y-center   box-x-between">
            <div class="user box-row box-y-center">
                <img class="user-profile-pic" src="./resources/photo.jpg" alt="akrck02" >
                <div class="msg-info box-column">
                    <p class="username">Akrck02</p>
                    <p class="date">4 min ago</p>
                </div>
            </div>
            <span class="material-symbols-outlined">more_vert</span>
        </div>
        <p class="message-to">To Juan Diaz</p>
        <div class="content">
            LaoQuian! It's been to long! How are you? <br><br>
            I've been thinking about home and wiw so much lately. <br><br>
            Are you free next weekend? Diaz and odasuda want to catch up with you!
        </div>
        <div class="button-bar">
            <div class="box-row box-x-center">
                <button>Discard</button>
                <button class="primary">Reply</button>
            </div>
        </div>
    </div>

    <button class="new-mail primary">
        <span class="material-symbols-outlined">edit</span>
    </button>

    <div class="nav-bar box-row box-center secondary-container">
        <div class="box-column button-group">
            <button id="inbox">
                <span class="material-symbols-outlined">all_inbox</span>
            </button>
            <label for="inbox">inbox</label>
        </div>
        <div class="box-column button-group">
            <button id="inbox">
                <span class="material-symbols-outlined">group</span>
            </button>
            <label for="group">groups</label>
        </div>
        <div class="separator"></div>

        <div class="box-column button-group">
            <button id="inbox">
                <span class="material-symbols-outlined">chat</span>
            </button>
            <label for="chat">chat</label>
        </div>
        <div class="box-column button-group">
            <button id="account_circle">
                <span class="material-symbols-outlined">account_circle</span>
            </button>
            <label for="account_circle">inbox</label>
        </div>
    </div>

</body>

</html>